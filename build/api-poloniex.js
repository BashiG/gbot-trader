(function(){var n,e,t,r,u;n=require("./conf"),e=require("poloniex-api-node"),t=require("bluebird"),r=require("lodash"),u=function(){function u(){}u.displayName="API";var o;u.prototype;return o=new e(n.poloniexKey,n.poloniexSecret),u.prototype.getTicker=function(n,e){return new t(function(e,t){return o.returnTicker(function(u,o){var c;return u?t(u):(c=r.split(n,"-"),o=r.pick(o,c),Object.keys(o).forEach(function(n){o[n].buy=+o[n].lowestAsk,o[n].sell=+o[n].highestBid,o[n].last=+o[n].last,o[n].vol=+o[n].quoteVolume,o[n].vol_cur=+o[n].baseVolume,delete o[n].lowestAsk,delete o[n].highestBid,delete o[n].quoteVolume,delete o[n].baseVolume}),e(o))})}).then(function(n){return e(null,n)}).catch(function(n){return e(n)})},u.prototype.getInfo=function(e){return new t(function(e,t){return o.returnTicker(function(r,u){var o,c,i;return r?t(r):(o=8,c=1/+("1e"+o),i={pairs:{}},Object.keys(u).forEach(function(e){i.pairs[e.toUpperCase()]={decimal_places:o,min_amount:.0015,min_price:+c,fee:+n.poloniexFee}}),e(i))})}).then(function(n){return e(null,n)}).catch(function(n){return e(n)})},u.prototype.getTrades=function(n,e,t){var u;return u={},r.split(n,"-").forEach(function(n){u[n]=[{timestamp:0},{timestamp:0}]}),t(null,u)},u.prototype.ordersRequest=function(n,e){return new t(function(e,t){return o.returnOpenOrders(n,function(n,r){var u;return n?t(n):r.length?(u={},r.forEach(function(n){u[n.orderNumber]={type:n.type,amount:+n.amount,rate:+n.rate,timestamp_created:0}}),e(u)):(n={success:0,error:"no orders"},t(n))})}).then(function(n){return e(null,n)}).catch(function(n){return e(n)})},u.prototype.balanceRequest=function(n,e){return new t(function(n,e){return o.returnBalances(function(t,r){return t?e(t):n(r)})}).then(function(t){return e(null,+t[n.name],+t[n.nameTwo])}).catch(function(n){return e(n)})},u.prototype.tradeSetOrder=function(e,u,c,i,a){var l,f,p=this;return l=r.split(e,"_"),f={pair:e,name:l[0],nameTwo:l[1]},"buy"===u?new t(function(t,u){return o.buy(e,c,i,null,null,null,function(e,o){return e?u(e):r.delay(p.balanceRequest,n.poloniexDelayApi,f,function(n,e,r){var c,i;return c={order_id:o.orderNumber,funds:(i={},i[f.name+""]=+e,i[f.nameTwo+""]=+r,i)},n?u(n):t(c)})})}).then(function(n){return a(null,n)}).catch(function(n){return a(n)}):new t(function(t,u){return o.sell(e,c,i,null,null,null,function(e,o){return e?u(e):r.delay(p.balanceRequest,n.poloniexDelayApi,f,function(n,e,r){var c,i;return c={order_id:o.orderNumber,funds:(i={},i[f.name+""]=+e,i[f.nameTwo+""]=+r,i)},n?u(n):t(c)})})}).then(function(n){return a(null,n)}).catch(function(n){return a(n)})},u.prototype.tradeCancelOrder=function(n,e){return new t(function(e,t){return o.cancelOrder(n.order_id,function(n,r){return n?t(n):e(r)})}).then(function(n){return e(null,n)}).catch(function(n){return e(n)})},u.prototype.tradeGetHistory=function(n,e,r){return new t(function(t,r){return o.returnMyTradeHistory(n,Math.round((new Date).getTime()/1e3)-86400,null,function(n,u){var o;return n?r(n):(u=u.splice(0,e),o={},u.forEach(function(n){o[n.globalTradeID]={type:n.type,amount:+n.amount,rate:+n.rate}}),t(o))})}).then(function(n){return r(null,n)}).catch(function(n){return r(n)})},u.prototype.setNonce=function(n){},u}(),module.exports=u}).call(this);