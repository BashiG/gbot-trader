(function(){var a,b,c,d,e;a=require("./conf"),b=require("poloniex-api-node"),c=require("bluebird"),d=require("lodash"),e=function(){function g(){}g.displayName="API";g.prototype;return g.prototype.poloniex=new b(a.poloniexKey,a.poloniexSecret),g.prototype.getTicker=function(a,b){var e=this;return new c(function(b,c){return e.poloniex.returnTicker(function(e,f){var g;return e?c(e):(g=d.split(a,"-"),f=d.pick(f,g),Object.keys(f).forEach(function(a){f[a].buy=+f[a].lowestAsk,f[a].sell=+f[a].highestBid,f[a].last=+f[a].last,delete f[a].lowestAsk,delete f[a].highestBid}),b(f))})}).then(function(a){return b(null,a)}).catch(function(a){return b(a)})},g.prototype.getInfo=function(b){var d=this;return new c(function(b,c){return d.poloniex.returnTicker(function(d,e){var f,g,h;return d?c(d):(f=8,g=1/+("1e"+f),h={pairs:{}},Object.keys(e).forEach(function(b){h.pairs[b.toUpperCase()]={decimal_places:f,min_amount:.0015,min_price:+g,fee:+a.poloniexFee}}),b(h))})}).then(function(a){return b(null,a)}).catch(function(a){return b(a)})},g.prototype.getTrades=function(a,b,c){var e,f;return e={},f=d.split(a,"-"),f.forEach(function(a){e[a]=[{timestamp:0},{timestamp:0}]}),c(null,e)},g.prototype.ordersRequest=function(a,b){var d=this;return new c(function(b,c){return d.poloniex.returnOpenOrders(a,function(a,d){var e;return a?c(a):d.length?(e={},d.forEach(function(a){e[a.orderNumber]={type:a.type,amount:+a.amount,rate:+a.rate,timestamp_created:0}}),b(e)):(a={success:0,error:"No open orders"},c(a))})}).then(function(a){return b(null,a)}).catch(function(a){return b(a)})},g.prototype.balanceRequest=function(a,b){var d=this;return new c(function(a,b){return d.poloniex.returnBalances(function(c,d){return c?b(c):a(d)})}).then(function(c){return b(null,+c[a.name],+c[a.nameTwo])}).catch(function(a){return b(a)})},g.prototype.tradeSetOrder=function(a,b,e,f,g){var h,i,j=this;return h=d.split(a,"_"),i={pair:a,name:h[0],nameTwo:h[1]},"buy"===b?new c(function(b,c){return j.poloniex.buy(a,e,f,null,null,null,function(a,d){return a?c(a):j.balanceRequest(i,function(a,d,e){var f,g;return f={funds:(g={},g[i.name+""]=+d,g[i.nameTwo+""]=+e,g)},a?c(a):b(f)})})}).then(function(a){return g(null,a)}).catch(function(a){return g(a)}):new c(function(b,c){return j.poloniex.sell(a,e,f,null,null,null,function(a,d){return a?c(a):j.balanceRequest(i,function(a,d,e){var f,g;return f={funds:(g={},g[i.name+""]=+d,g[i.nameTwo+""]=+e,g)},a?c(a):b(f)})})}).then(function(a){return g(null,a)}).catch(function(a){return g(a)})},g.prototype.tradeCancelOrder=function(a,b){var d=this;return new c(function(b,c){return d.poloniex.cancelOrder(a.order_id,function(a,d){return a?c(a):b(d)})}).then(function(a){return b(null,a)}).catch(function(a){return b(a)})},g.prototype.tradeGetHistory=function(a,b,d){var e=this;return new c(function(c,d){return e.poloniex.returnMyTradeHistory(a,Math.round((new Date).getTime()/1e3)-86400,null,function(a,e){var f;return a?d(a):(e=e.splice(0,b),f={},e.forEach(function(a){f[a.globalTradeID]={type:a.type,amount:+a.amount,rate:+a.rate}}),c(f))})}).then(function(a){return d(null,a)}).catch(function(a){return d(a)})},g}(),module.exports=e}).call(this);