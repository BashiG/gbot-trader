(function(){function e(e,t){for(var r=-1,n=t.length>>>0;++r<n;)if(e===t[r])return!0;return!1}var t,r,n,a,u;t=require("../conf"),r=require("@you21979/bittrex.com"),n=require("lodash"),require("async"),a=require("moment"),u=function(){function u(){}u.displayName="API";var o,c;return u.prototype,o=r.PublicApi,c=r.createPrivateApi(t.key,t.secret,"btce-app-trader"),u.prototype.getTicker=function(t,r){return 1===n.split(t,"-").length?o.getTicker(t).then(function(e){var n,a;return a={},a[t+""]={buy:+e.Ask,sell:+e.Bid,last:+e.Last},n=a,r(null,n)}).catch(function(e){return r(e.message)}):o.getMarketSummaries().then(function(a){var u,o;return u=n.split(t,"-"),o={},Object.keys(a).forEach(function(t){var r;e(r=a[t].MarketName.replace("-","_").toLowerCase(),u)&&(o[r]={buy:+a[t].Ask,sell:+a[t].Bid,last:+a[t].Last,vol:+a[t].Volume,vol_cur:+a[t].BaseVolume})}),r(null,o)}).catch(function(e){return r(e.message)})},u.prototype.getInfo=function(e){return o.getMarkets().then(function(r){var n;return n={pairs:{}},Object.keys(r).forEach(function(e){var a;a=r[e].MarketName.replace("-","_").toLowerCase(),n.pairs[a]={decimal_places:8,min_amount:+r[e].MinTradeSize,min_price:1e-8,fee:+t.exchangeFee}}),e(null,n)}).catch(function(t){return e(t.message)})},u.prototype.getTrades=function(e,t,r){var a;return a={},n.split(e,"-").forEach(function(e){a[e]=[{timestamp:0},{timestamp:0}]}),r(null,a)},u.prototype.ordersRequest=function(e,t){return c.getOpenOrders({market:e.replace("_","-").toUpperCase()}).then(function(e){var r,n;return e.length?(n={},e.forEach(function(e){n[e.OrderUuid]={type:/buy/.test(e.OrderType.toLowerCase())?"buy":"sell",amount:+e.Quantity,rate:+e.Limit,timestamp_created:a(e.Opened).unix()}}),t(null,n)):(r={success:0,error:"no orders"},t(r))}).catch(function(e){return t(e.message)})},u.prototype.balanceRequest=function(e,t){return c.getBalances().then(function(r){var n,a;return n=0,a=0,Object.keys(r).forEach(function(t){var u;(u=r[t].Currency.toLowerCase())===e.name&&(n=+r[t].Available),u===e.nameTwo&&(a=+r[t].Available)}),t(null,n,a)}).catch(function(e){return t(e.message)})},u.prototype.tradeSetOrder=function(e,r,a,u,o){var i,s,l=this;return i=n.split(e,"_"),s={pair:e,name:i[0],nameTwo:i[1]},"buy"===r?c.buyLimit(e.replace("_","-").toUpperCase(),u,a).then(function(e){return n.delay(l.balanceRequest,t.delayRequestApi,s,function(t,r,n){var a,u;return a={order_id:e.uuid,funds:(u={},u[s.name+""]=+r,u[s.nameTwo+""]=+n,u)},o(null,a)})}).catch(function(e){return o(e.message)}):c.sellLimit(e.replace("_","-").toUpperCase(),u,a).then(function(e){return n.delay(l.balanceRequest,t.delayRequestApi,s,function(t,r,n){var a,u;return a={order_id:e.uuid,funds:(u={},u[s.name+""]=+r,u[s.nameTwo+""]=+n,u)},o(null,a)})}).catch(function(e){return o(e.message)})},u.prototype.tradeCancelOrder=function(e,t){return c.cancel(e.order_id).then(function(e){return t(null,e)}).catch(function(e){return t(e.message)})},u.prototype.tradeGetHistory=function(e,t,r){return c.getOrderHistory({market:e.replace("_","-").toUpperCase()}).then(function(e){var n;return e=e.splice(0,t),n={},e.forEach(function(e){n[e.OrderUuid]={type:/buy/.test(e.OrderType.toLowerCase())?"buy":"sell",amount:+e.Quantity,rate:+e.Limit}}),r(null,n)}).catch(function(e){return r(e.message)})},u.prototype.setNonce=function(e){},u}(),module.exports=u}).call(this);