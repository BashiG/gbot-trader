(function(){var e,t,r,n;e=require("../conf"),t=require("poloniex-api-node"),r=require("lodash"),n=function(){function n(){}n.displayName="API";var o;return o=new t(e.key,e.secret),n.prototype.getTicker=function(e,t){return o.returnTicker().then(function(n){var o;return o=r.split(e.toUpperCase(),"-"),n=r.pick(n,o),Object.keys(n).forEach(function(e){n[e.toLowerCase()]={buy:+n[e].lowestAsk,sell:+n[e].highestBid,last:+n[e].last,vol:+n[e].quoteVolume,vol_cur:+n[e].baseVolume},delete n[e]}),t(null,n)}).catch(function(e){return t(e)})},n.prototype.getInfo=function(t){return o.returnTicker().then(function(r){var n;return n={pairs:{}},Object.keys(r).forEach(function(t){n.pairs[t.toLowerCase()]={decimal_places:8,min_amount:.0015,min_price:1e-8,fee:+e.exchangeFee}}),t(null,n)}).catch(function(e){return t(e)})},n.prototype.getTrades=function(e,t,n){var o;return o={},r.split(e,"-").forEach(function(e){o[e]=[{timestamp:0},{timestamp:0}]}),n(null,o)},n.prototype.ordersRequest=function(e,t){return o.returnOpenOrders(e.toUpperCase()).then(function(e){var r;return e.length?(r={},e.forEach(function(e){r[e.orderNumber]={type:e.type,amount:+e.amount,rate:+e.rate,timestamp_created:0}}),t(null,r)):t({success:0,error:"no orders"})}).catch(function(e){return t(e)})},n.prototype.balanceRequest=function(e,t){return o.returnBalances().then(function(r){return t(null,+r[e.name.toUpperCase()],+r[e.nameTwo.toUpperCase()])}).catch(function(e){return t(e)})},n.prototype.tradeSetOrder=function(t,n,u,a,c){var i,l;return i=r.split(t,"_"),l={pair:t,name:i[0],nameTwo:i[1]},"buy"===n?o.buy(t.toUpperCase(),u,a).then(function(t){return r.delay(this.balanceRequest,e.delayRequestApi,l,function(e,r,n){var o,u;return null!=e?c(e):(o={order_id:t.orderNumber,funds:(u={},u[l.name+""]=+r,u[l.nameTwo+""]=+n,u)},c(null,o))})}).catch(function(e){return c(e)}):o.sell(t.toUpperCase(),u,a).then(function(t){return r.delay(this.balanceRequest,e.delayRequestApi,l,function(e,r,n){var o,u;return null!=e?c(e):(o={order_id:t.orderNumber,funds:(u={},u[l.name+""]=+r,u[l.nameTwo+""]=+n,u)},c(null,o))})}).catch(function(e){return c(e)})},n.prototype.tradeCancelOrder=function(e,t){return o.cancelOrder(e.order_id).then(function(e){return t(null,e)}).catch(function(e){return t(e)})},n.prototype.tradeGetHistory=function(e,t,n){return o.returnMyTradeHistory(e.toUpperCase(),Math.round(r.now()/1e3)-86400).then(function(e){var r;return e=e.splice(0,t),r={},e.forEach(function(e){r[e.globalTradeID]={type:e.type,amount:+e.amount,rate:+e.rate}}),n(null,r)}).catch(function(e){return n(e)})},n.prototype.setNonce=function(e){},n}(),module.exports=n}).call(this);