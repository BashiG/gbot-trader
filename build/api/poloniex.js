(function(){var e,n,t,r,u;e=require("../conf"),n=require("poloniex-api-node"),t=require("bluebird"),r=require("lodash"),u=function(){function u(){}u.displayName="API";var o;return u.prototype,o=new n(e.key,e.secret),u.prototype.getTicker=function(e,n){return new t(function(n,t){return o.returnTicker(function(u,o){var c;return u?t(u):(c=r.split(e.toUpperCase(),"-"),o=r.pick(o,c),Object.keys(o).forEach(function(e){o[e.toLowerCase()]={buy:+o[e].lowestAsk,sell:+o[e].highestBid,last:+o[e].last,vol:+o[e].quoteVolume,vol_cur:+o[e].baseVolume},delete o[e]}),n(o))})}).then(function(e){return n(null,e)}).catch(function(e){return n(e)})},u.prototype.getInfo=function(n){return new t(function(n,t){return o.returnTicker(function(r,u){var o,c,a;return r?t(r):(o=8,c=1/+("1e"+o),a={pairs:{}},Object.keys(u).forEach(function(n){a.pairs[n.toLowerCase()]={decimal_places:o,min_amount:.0015,min_price:+c,fee:+e.exchangeFee}}),n(a))})}).then(function(e){return n(null,e)}).catch(function(e){return n(e)})},u.prototype.getTrades=function(e,n,t){var u;return u={},r.split(e,"-").forEach(function(e){u[e]=[{timestamp:0},{timestamp:0}]}),t(null,u)},u.prototype.ordersRequest=function(e,n){return new t(function(n,t){return o.returnOpenOrders(e.toUpperCase(),function(e,r){var u;return e?t(e):r.length?(u={},r.forEach(function(e){u[e.orderNumber]={type:e.type,amount:+e.amount,rate:+e.rate,timestamp_created:0}}),n(u)):(e={success:0,error:"no orders"},t(e))})}).then(function(e){return n(null,e)}).catch(function(e){return n(e)})},u.prototype.balanceRequest=function(e,n){return new t(function(e,n){return o.returnBalances(function(t,r){return t?n(t):e(r)})}).then(function(t){return n(null,+t[e.name.toUpperCase()],+t[e.nameTwo.toUpperCase()])}).catch(function(e){return n(e)})},u.prototype.tradeSetOrder=function(n,u,c,a,i){var l,f,p=this;return l=r.split(n,"_"),f={pair:n,name:l[0],nameTwo:l[1]},"buy"===u?new t(function(t,u){return o.buy(n.toUpperCase(),c,a,null,null,null,function(n,o){return n?u(n):r.delay(p.balanceRequest,e.delayRequestApi,f,function(e,n,r){var c,a;return c={order_id:o.orderNumber,funds:(a={},a[f.name+""]=+n,a[f.nameTwo+""]=+r,a)},e?u(e):t(c)})})}).then(function(e){return i(null,e)}).catch(function(e){return i(e)}):new t(function(t,u){return o.sell(n.toUpperCase(),c,a,null,null,null,function(n,o){return n?u(n):r.delay(p.balanceRequest,e.delayRequestApi,f,function(e,n,r){var c,a;return c={order_id:o.orderNumber,funds:(a={},a[f.name+""]=+n,a[f.nameTwo+""]=+r,a)},e?u(e):t(c)})})}).then(function(e){return i(null,e)}).catch(function(e){return i(e)})},u.prototype.tradeCancelOrder=function(e,n){return new t(function(n,t){return o.cancelOrder(e.order_id,function(e,r){return e?t(e):n(r)})}).then(function(e){return n(null,e)}).catch(function(e){return n(e)})},u.prototype.tradeGetHistory=function(e,n,r){return new t(function(t,r){return o.returnMyTradeHistory(e.toUpperCase(),Math.round((new Date).getTime()/1e3)-86400,null,function(e,u){var o;return e?r(e):(u=u.splice(0,n),o={},u.forEach(function(e){o[e.globalTradeID]={type:e.type,amount:+e.amount,rate:+e.rate}}),t(o))})}).then(function(e){return r(null,e)}).catch(function(e){return r(e)})},u.prototype.setNonce=function(e){},u}(),module.exports=u}).call(this);