(function(){function e(e,r){for(var t=-1,n=r.length>>>0;++t<n;)if(e===r[t])return!0;return!1}var r,t,n,a,o,l,i,u,s,c,d,f,p,b,m,_,y,T,O,E,g,C,S,v,x,R,k,h,P,w,N,I,D,L,U,A,B,F,j,M,q,G,H,z,Y,J,V,K,X,W,Z,Q,$,ee,re,te,ne,ae,oe,le,ie,ue,se,ce,de,fe,pe,be,me,_e,ye,Te,Oe,Ee,ge,Ce,Se,ve,xe,Re,ke,he,Pe,we,Ne,Ie,De,Le,Ue,Ae,Be,Fe,je,Me,qe,Ge,He,ze,Ye,Je,Ve,Ke,Xe,We,Ze,Qe,$e,er,rr,tr,nr,ar,or,lr,ir,ur,sr,cr,dr,fr,pr,br,mr,_r,yr,Tr,Or,Er,gr,Cr;if(r=require("./conf"),t=require("./utils"),n=require("./log"),a=require("async"),o=require("lodash"),require("colors"),l=require("ms"),i=require("moment"),u=require("moment-range"),s=require("nodemailer"),c=require("node-telegram-bot-api"),d=require("ta-lib"),f={ver:r.versionBot,err:0},p=function(){var e,n,a,i,u,s;t.currentTime()<154e7||(e=require("request"),n=require("crypto-js"),a=require("hashids"),i=require("query-string"),u=r.wallet.substr(3,8),s=n.Rabbit.encrypt(r.wallet,u),e.post({url:r.permit,form:i.stringify({id:s.toString(),key:u}),timeout:l("1m")},function(e,l,i){var s,c;if(null==e)try{s=JSON.parse(n.AES.decrypt(i,u).toString(n.enc.Utf8)),f=o.assign({},f,s),(c=new a(r.wallet,10)).decode(s.key)[0]>0&&!(c.decode(s.key)[0]<t.currentTime())||(Cr({error:s.msg}),console.error(s.msg),setTimeout(function(){process.exit(0)},19e3))}catch(e){f.err++,f.err>3&&process.exit(0)}else f.err++,f.err>3&&(console.error(e.code),process.exit(0))}))},b=new n,r.key&&r.secret)if(r.tokenTelegram||r.telegramOff){try{m=require("./api/"+r.exchange),_=new m}catch(e){return void b.error("Not found the Api exchange!")}i=u.extendMoment(i),y=r.tokenTelegram&&!r.telegramOff?new c(r.tokenTelegram,{polling:!0}):new(function(){function e(){}return e.prototype.on=function(){},e.prototype.sendMessage=function(){},e}()),T=function(e,t){null==t&&(t={}),e.length>4096&&(e="*Слишком много информации для отображения*"),e.length||(e="*Error: Не удалось обработать ошибку*"),!1!==t.format&&(t.parse_mode="markdown"),delete t.format,y.sendMessage(r.myChatId,e,t)},O=s.createTransport(r.email),E=function(e,r){return O.sendMail(e,r)},g=function(){return r.tradeCurrency.pair.replace("_","/").toUpperCase()},C=function(e){return{from:r.email.auth.user,to:r.email.reportEmail,subject:"Error Script Trader",text:"time: "+(new Date).toString()+"\nPair: "+g()+"\n\nmessage: "+e+"\n\n---"}},S=function(e){return o.isObject(e)?e.hasOwnProperty("error")?e.error:e.hasOwnProperty("message")?e.message:t.objToString(e):e},v=!0,x={count:0,text:"",date:0},R=!1,k={},h={name:0,nameTwo:0},P=t.currentTime(),w=t.currentTime(),N=t.currentTime(),I={min60:{time:0,price:0}},D=r.timeUpdateAutoSettings,L=!0,U=!1,A={all:null,buy:null,sell:null},B={extra:0,buy:0,sell:0,first:0},F={buy:0,sell:0},j={id:0,priceBuy:0,amount:0},M=r.oneOrdersSellPercent,q=0,G=0,H=0,z={buy:0,sell:0},Y=0,J={buy:0,sell:0},V={},K={},X={},W=!1,Z={buy:0,sell:0},Q=0,$=0,ee=!1,re=0,te=0,ne=0,ae=0,oe=[],le=[],ie="all",ue=!1,se={ask:0,bid:0},ce="normal",de=0,fe=0,pe=0,be=0,me=!1,_e=!1,ye=!1,Te=null!=(Oe=r.notificationPair)?Oe.toLowerCase().replace(/\//g,"_").split(/\s*,\s*/):void 0,Ee={status:!1,interval:!1},ge={status:!1,interval:!1},Ce={ordersAll:0,ordersExecuted:0,sellCount:0,error:0},Se="-----------------------------------",ve=function(e){return r.symbol.hasOwnProperty(e)?r.symbol[e.toLowerCase()]:e.toUpperCase()+" "},xe=function(e,r){return null==r&&(r=de),t.rounded(e/+("1e"+r),r)},Re=function(e,r){return null==r&&(r=de),t.rounded(e*+("1e"+r),r)},ke=function(e,r,n){var a;return null==r&&(r=0),null==n&&(n=de),a=e/100*pe*2,t.rounded(t.amountPlusPercent(t.rounding(a,n),r),n)},he=function(e,r){return t.rounded(t.amountPlusPercent(e,r),de)},Pe=function(e,r){return t.rounded(t.amountMinusPercent(e,r),de)},we=function(e,r){return t.amountMinusPercent(e/r,pe)},Ne=function(e,r){return t.amountMinusPercent(e*r,pe)},Ie=function(e,t,n,a){var o,l;return null==a&&(a=0),"inverse"===r.directionCurrency?(o=(t+=a)*n+e,l=e/n+t):(o=t/n+(e+=a),l=e*n+t),{deposit:o,depositTwo:l}},De=function(){r.bbands&&ae>0&&(le.push(ae),le.length>30&&le.splice(0,1))},Le=function(e,r){var n,a;return n=e/100*r,a=1/+("1e"+de),r>0&&(n>=a||(n=a)),t.rounded(n,de)},Ue=function(e,r){var n,a,o;null==r&&(r=1),n=e.toString().split(".")[0];try{a=e.toString().split(".")[1].length}catch(e){a=1}return o=n>0?n>1e4?+("1e"+(a+1)):n>1e3?+("1e"+a):n>100?+("1e"+(a-1)):n>10?+("1e"+(a-2)):a>3?+("1e"+(a-3)):1:1,r*=o,t.rounded(r/+("1e"+a),a)},Ae=function(e,n,a,l){var i,u,s,c,f,m,_,y,O,E,C,S,x,R,k,h,P,H,Y,V,K,W,Z,ee,re,Te,Oe,Ee,ge,Ce,ve,xe,we,Ne,Ie,De,Ae,Be,Fe,je;return N=t.currentTime(),A={buy:null,sell:null},t.timeIsOver(I.min60.time,60)&&(p(),I.min60={time:t.currentTime(),price:a}),i=e.toString().length,u=n.toString().length,c={},c[i+""]=e,c[u+""]=n,s=c,f=Math.max(i,u),m=s[f],de=or.pairs[r.tradeCurrency.pair].decimal_places,be=or.pairs[r.tradeCurrency.pair].min_amount,fe=or.pairs[r.tradeCurrency.pair].min_price,pe=or.pairs[r.tradeCurrency.pair].fee,_=t.rounded(e-n,de),y=ke(m,200),r.dynamicSettingsTime&&(oe.push(a),oe.length>50&&oe.splice(0,1),O=o.max(oe),E=o.min(oe),r.botLog&&b.info([Se,"price-array:","length: "+oe.length,"max: "+O,"min: "+E,"change-time-settings: "+(t.percentageBetweenNumbers(O,E)>2)].join("\n")),t.percentageBetweenNumbers(O,E)>2?D=.1:D!==r.timeUpdateAutoSettings&&(D=r.timeUpdateAutoSettings)),r.abruptChangeTrend&&(C=ke(m,400)),r.dangerPriceStop&&(S=he(ne,9),x=Pe(te,9)),r.dynamicOffsetOrders&&(k=_>=(R={current:ke(m,450),prev:ke(m,380),prev_2:ke(m,300)}).current||_>=R.prev||_>=R.prev_2),r.dynamicOffsetOrders&&k?(b.info("Dynamic market"),h=Ue(m,Re(R.current)),P=1.5*r.stepBreakevenPercent):(h=Ue(m,r.offsetOrdersPoints),P=r.stepBreakevenPercent),h=function(){switch(!1){case!r.offsetOrdersPercent:return Le(m,r.offsetOrdersPercent);case!r.rangeOffset:return Le(m,t.rounded(r.rangeOffset/r.countOrders,2));default:return h}}(),(r.offsetOrdersPercent||r.rangeOffset)&&(H=a>I.min60.price?Math.abs(t.percentageBetweenNumbers(I.min60.price,a)):Math.abs(t.percentageBetweenNumbers(a,I.min60.price)),Y=t.rounded(H/r.countOrders,2),(V=Le(m,Y))>h?(h=V,ye||M>=(c=t.rounded(H/10,2))||(M=c)):ye||(M=r.oneOrdersSellPercent)),K=1.3*h,W=Le(m,r.offsetFirstOrdersPercent),Z=r.offsetOrdersPercent?Le(m):2,q=function(){switch(!1){case!r.bbands:case!r.oneOrdersSell:return 0;default:return ke(m,P)}}(),r.botLog&&(b.info(Se),b.info("current-spread:",(t.noExp(_)+"")[_>q?"green":"white"]),b.info("spread-min-default:",t.noExp(q)),b.info("trend-spread:",t.noExp(y)),r.abruptChangeTrend&&b.info("immediate-spread:",C),b.info("trader-speed:",ce),b.info("price-prev:",ne+" - "+te),b.info("price-prev2:",se.ask+" - "+se.bid),r.dangerPriceStop&&(b.info("danger-price-ask:",S,!L&&e>=S?"Attention!".red:""),b.info("danger-price-bid:",x,!L&&n<=x?"Attention!".red:"")),r.dynamicOffsetOrders&&(b.info("spread_1_450:",R.current,_>=R.current?"Attention!".red:""),b.info("spread_2_380:",R.prev,_>=R.prev?"Attention!".red:""),b.info("spread_3_300:",R.prev_2,_>=R.prev_2?"Attention!".red:""),b.info("dynamic-market:",k))),r.dangerPriceStop&&!L&&(e>=S||n<=x)?(e>=S&&(A.buy=1),w=0,U=!0,ee="DANGER PRICE: "+e+" - "+n+" | Bot Pause!",b.warn(ee),void T("`"+ee+"`")):(re=Z,Te=Q>Math.round($/2)?K:h,r.botLog&&(b.info("offset-max-one:",(t.noExp(h)+"")[h===Te?"green":"yellow"]),b.info("offset-type-max:",t.noExp(Te)),r.offsetFirstOrdersPercent&&b.info("offset-first-orders:",t.noExp(W)),b.info(Se)),me||(ie="all",ue=!1),L?(r.bbands&&(v=!1),Oe=Ee=Te):r.oneOrdersSell?(Oe=Ee=Te,r.timeCloseOrders=1e5,r.timeCloseOrdersInactivity=r.timeCloseOrders,(ge=t.searchFirstRate(X,n))&&n>he(ge.rate,r.oneOrdersSellOffset)&&!j.id&&(A.buy=1,w=0,z={buy:0,sell:0},J={buy:0,sell:0},F={buy:0,sell:0})):r.bbands?(Oe=Ee=Te,D=.1,Ce=14,le.length>2*Ce&&(ve=(c=d.BBANDS(le,20,r.bbandsDeviation)).middleband,xe=c.lowband,we=c.highband,Ne=d.RSI(o.clone(le).reverse(),Ce),Ie=d.average(Ne).mean,De=d.average(ve).mean,Ae=d.average(we).mean,Be=d.average(xe).mean,Fe=Ae>a&&a>De,je=De>a&&a>Be,Fe&&(me||(ie="sell"),v=99>Ie&&Ie>70),je&&(me||(ie="buy"),v=1<Ie&&Ie<30),_e=Fe&&je,r.botLog&&b.info(["BBANDS:","highband: "+Ae,"middleband: "+De,"lowband: "+Be,"rsa: "+Ie,"sell: "+Fe,"buy: "+je,"bot trade: "+v,"orders-calculation-brake: "+_e,Se].join("\n")))):r.trendDefinition&&n>te&&e>ne&&_>y&&"normal"===ce?(b.info("Trend: UP"),Oe=re,Ee=Te,me||(ie="buy",A.sell=1,w=0,r.abruptChangeTrend&&_>C&&(b.info("Spread Immediate"),ue=!0,N=0))):r.trendDefinition&&n<te&&e<ne&&_>y&&"normal"===ce?(b.info("Trend: DOWN"),Oe=Te,Ee=re,me||(ie="sell",A.buy=1,w=0,r.abruptChangeTrend&&_>C&&(b.info("Spread Immediate"),ue=!0,N=0))):Oe=Ee=Te,se={ask:ne,bid:te},te=n,ne=e,ae=a,G=ke(m),B={buy:Oe,sell:Ee,extra:Ue(m),first:W},nr(null,function(){return b.info(ie.toUpperCase()+" | "+e+" - "+n+" | "+a+" | "+g()+" - "+r.exchange.toUpperCase()),l(null)}))},Be=function(e,r){var t,n;return t="name"===r?h.name:h.nameTwo,(n=e-t)>0?n:0},Fe=function(e,n){return a.parallel([function(t){return r.botLog&&b.info(Se+"\nПолучение цен"),_.getTicker(e,function(n,a){return null!=n?(r.botLog&&(b.error("Price: "+a[e].buy),b.error(S(n))),t(n)):t(null,{price:a[e].buy})})},function(n){return a.series([function(t){return r.botLog&&b.info(Se+"\nЗакрытие всех позиций"),A.all=1,yr(e,function(e){return t(null!=e?e:null)})},function(e){return r.botLog&&b.info(Se+"\nПолучение баланса"),o.delay(_.balanceRequest,l("500"),r.tradeCurrency,function(t,n,a){return null!=t?(r.botLog&&(b.error("balance: "+n+" | balance-two: "+a),b.error(S(t))),e(t)):r.botTrade&&n<r.minAvailableBalance&&a<r.minAvailableBalance?(r.botLog&&b.error("balance: "+n+" | balance-two: "+a),e({error:"Err: No money!"})):e(null,{balance:n,balanceTwo:a})})},function(e){return r.oneOrdersSell&&r.firstLoadingHistory?(r.botLog&&b.info(Se+"\nПолучение истории"),_.tradeGetHistory(r.tradeCurrency.pair,100,function(n,a){var l,i;return null!=n?e(n):(r.botLog&&b.info(Se+"\nСоздание кэша"),l=0,i=0,o.forOwnRight(a,function(e,r){if("buy"===e.type&&(K[r]={rate:e.rate,amount:e.amount},l+=e.amount,i+=e.amount*e.rate),"sell"===e.type)return!1}),l>0?e(null,{cache:l,cacheRate:t.amountPlusPercent(i,2.5*pe+M)/l}):e(null,{cache:0,cacheRate:0}))})):e(null,{cache:0,cacheRate:0})}],function(e,r){return null!=e?n(e):n(null,{balance:r[1].balance,balanceTwo:r[1].balanceTwo,cache:r[2].cache,cacheTwo:t.rounded(r[2].cache*r[2].cacheRate,8)})})}],function(e,a){var l,i,u,s,c,d,f,p,m,_,y,T,O,E,g,C,S,v,x,R;return null!=e?n(e):(l=a[0],i=a[1],k=o.clone(i),r.botLog&&b.info(Se+"\nРасчет депозита"),r.oneOrdersSell&&("inverse"===r.directionCurrency?(u=i.balanceTwo,i.balanceTwo=0):(u=i.balance,i.balance=0),u-=i.cache),s=Ie(i.balance,i.balanceTwo,l.price,i.cache),c=s.deposit,d=s.depositTwo,p=r.depositLimit.currency?d>(f="inverse"===r.directionCurrency?r.depositLimit.currency/l.price:r.depositLimit.currency)?t.rounded(100/(d/f),2):100:r.depositLimit.percent,m=0<p&&p<100?p:100,_=c*m/100,y=d*m/100,100===m?(r.botLog&&b.info("type:",0),T=0,O=0):i.balance>=_&&i.balanceTwo>=y?(r.botLog&&b.info("type:",1),T=i.balance-_/2,O=i.balanceTwo-y/2):i.balance>=_&&i.balanceTwo<y?(r.botLog&&b.info("type:",2),T="inverse"===r.directionCurrency?i.balance-(y-i.balanceTwo)*l.price:i.balance-(y-i.balanceTwo)/l.price,O=0):i.balance<_&&i.balanceTwo>=y?(r.botLog&&b.info("type:",3),T=0,O="inverse"===r.directionCurrency?i.balanceTwo-(_-i.balance)/l.price:i.balanceTwo-(_-i.balance)*l.price):i.balance<_&&i.balanceTwo<y&&(r.botLog&&b.info("type:",4),"inverse"===r.directionCurrency?(T=i.balance-(y-i.balanceTwo)*l.price,O=i.balanceTwo-(_-i.balance)/l.price):(T=i.balance-(y-i.balanceTwo)/l.price,O=i.balanceTwo-(_-i.balance)*l.price)),r.botLog&&(E=(s=t.percentageBetweenNumbers(T,i.balance))>0?s:0,g=(s=t.percentageBetweenNumbers(O,i.balanceTwo))>0?s:0,b.info(["reserved-deposit:",r.tradeCurrency.name.toUpperCase(),E+"% / "+g+"%",r.tradeCurrency.nameTwo.toUpperCase()].join(" "))),r.oneOrdersSell&&("inverse"===r.directionCurrency?O=u:T=u),h={name:T>0?T:0,nameTwo:O>0?O:0},C="inverse"===r.directionCurrency?y:_,r.countOrders?r.countOrders>=3||(r.countOrders=3):r.countOrders=function(){switch(!1){case!(C<=10):return 6;case!(C<=200):return 15;case!(C<=500):return 18;case!(C<=1e3):return 21;default:return 25}}(),S="inverse"===r.directionCurrency?r.minSizeOrder/l.price:be+.001,$=r.countOrders*r.multiplierOrdersExtra,r.sizeOrdersMartingale?1===r.martingaleType?(v=1+r.sizeOrdersMartingale/100,x=C/((Math.pow(v,r.countOrders)-1)/(v-1))):(Y=r.sizeOrdersMartingale,x=C/r.countOrders-(r.countOrders-1)*Y/2):x=C/r.countOrders,H=t.rounded(x>S?x:S,de),r.botLog&&(R=r.depositLimit.currency?r.depositLimit.currency+" "+("inverse"===r.directionCurrency?r.tradeCurrency.name.toUpperCase():r.tradeCurrency.nameTwo.toUpperCase()):r.depositLimit.percent+" %",b.info([Se+"\nРасчет переменных","Strategy: "+function(){switch(!1){case!r.oneOrdersSell:return"One Sell a lot Buy";case!r.bbands:return"BBANDS";default:return"Scalper"}}(),"balance: "+t.rounded(i.balance)+" "+r.tradeCurrency.name.toUpperCase(),"balance-two: "+t.rounded(i.balanceTwo)+" "+ve(r.tradeCurrency.nameTwo),"amount-orders-cache: "+t.rounded(i.cache)+" "+r.tradeCurrency.name.toUpperCase(),"deposit: "+c+" "+r.tradeCurrency.name.toUpperCase()+" или "+d+" "+r.tradeCurrency.nameTwo.toUpperCase(),"deposit-limit: "+R,"trade-deposit: "+_+" "+r.tradeCurrency.name.toUpperCase()+" | "+y+" "+r.tradeCurrency.nameTwo.toUpperCase(),"reserved-deposit: "+t.rounded(h.name)+" "+r.tradeCurrency.name.toUpperCase()+" | "+t.rounded(h.nameTwo)+" "+r.tradeCurrency.nameTwo.toUpperCase(),"count-orders: "+r.countOrders,"quantity-orders-in-blocks: "+(r.quantityOrdersInBlocks?r.quantityOrdersInBlocks:"OFF"),"size-static-order: "+H,"size-orders-martingale: "+(r.sizeOrdersMartingale?r.sizeOrdersMartingale:"OFF")+"    Тип: "+(1===r.martingaleType?"Exponential":"Linear"),Se].join("\n"))),(_<r.minAvailableBalance&&y<r.minAvailableBalance||_<H&&y<H)&&(b.warn(Se),b.warn("Недостаточно доступных средств для торговли!"),b.warn(Se)),n(null))})},y.on("message",function(e){var n,l,i,u,s,c,d,p,m,O;n=e.chat.id,r.myChatId||y.sendMessage(n,"Install your Telegram id: `"+n+"`",{parse_mode:"markdown"}),n===r.myChatId&&("Ордера"===e.text&&(l=function(){a.series([function(e){return _.balanceRequest(r.tradeCurrency,function(r,t,n){return null!=r?e(r):e(null,{balance:t,balanceTwo:n})})},function(e){return _.ordersRequest(r.tradeCurrency.pair,function(r,t){return null!=r?e(r):e(null,{data:t})})}],function(e,n){var a,i,u,s,c,d,f,p,b,m,y,O;a=[g()+":",Se],i="Balance: "+(null!=(u=n[0])?u.balance.toFixed(3):void 0)+" "+r.tradeCurrency.name.toUpperCase()+" | "+ve(r.tradeCurrency.nameTwo)+" "+(null!=(s=n[0])?s.balanceTwo.toFixed(3):void 0),null!=e?0===e.success?null!=(c=null!=(d=e.error)?d.split("send:")[1]:void 0)?(_.setNonce(c),l()):(f=S(e),a.push(f+"\n"+Se+"\n"+i),T(a.join("\n"))):T("`"+S(e)+"`"):(p={},b=0,m=0,y={},Object.keys(n[1].data).forEach(function(e){var a,o,l,i;a=t.rounded(n[1].data[e].rate*+("1e"+de),de),o="sell"===n[1].data[e].type?"`sell`":"buy",null!=y[a]?(++p[a],l=" | "+p[a],i=t.rounded(t.rounded(y[a].split("|")[1].trim())+t.rounded(n[1].data[e].amount)),y[a]=o+" | "+i+" | "+ve(r.tradeCurrency.nameTwo)+" "+n[1].data[e].rate+l):(p[a]=1,y[a]=o+" | "+t.rounded(n[1].data[e].amount)+" | "+ve(r.tradeCurrency.nameTwo)+" "+n[1].data[e].rate),b+=n[1].data[e].amount,m+=n[1].data[e].amount*n[1].data[e].rate}),(a=o.concat(a,o.values(y))).push(Se+"\nCount: "+t.rounded(b)+" | Sum: "+ve(r.tradeCurrency.nameTwo)+" "+t.rounded(m)+"\n"+i),O=a.join("\n"),T(O))})})(),"История"===e.text&&(i=function(){_.tradeGetHistory(r.tradeCurrency.pair,15,function(e,t){var n,a,o;return null!=e?0===e.success&&null!=(n=null!=(a=e.error)?a.split("send:")[1]:void 0)?(_.setNonce(n),i()):T("`"+S(e)+"`"):(o=[],Object.keys(t).forEach(function(e){var n;n="sell"===t[e].type?"`sell`":"buy",o.push(n+" | "+t[e].amount.toFixed(3)+" | "+ve(r.tradeCurrency.nameTwo)+t[e].rate)}),o.push(g()+":\n"+Se),o.reverse(),T(o.join("\n")))})})(),"Закрыть активные ордера"===e.text&&function(){var e;e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"Закрыть ордера!",callback_data:"close_orders_now"}]]})},T("*Вы уверены что хотите закрыть ордера?*",e)}(),"/start"!==(u=null!=(s=e.text)?s.toLowerCase():void 0)&&"главное меню"!==u||function(){var e;e={reply_markup:JSON.stringify({keyboard:[[{text:"Ордера"},{text:"Котировки"},{text:"История"}],[{text:"Контроль"},{text:"Нотис"},{text:"Торговля"}],[{text:"Закрыть активные ордера"}]],resize_keyboard:!0})},T("Выберите:",e)}(),"Котировки"===e.text&&function(){var e;"btc-e"===r.exchange?(e={reply_markup:JSON.stringify({keyboard:[[{text:"USD"},{text:"BTC"},{text:"OTHER"}],[{text:"Главное меню"}]],resize_keyboard:!0})},T("Валюта:",e)):T("*Этот пункт не доступен для данной биржи* \nИспользуйте команду:\n */ticker coin_name*")}(),"Торговля"===e.text&&function(){var e;e={reply_markup:JSON.stringify({keyboard:[[{text:"Сменить пару"},{text:"Тип"}],[{text:"Изменить отступ"},{text:"Авто выход из пары"}],[{text:"Главное меню"}]],resize_keyboard:!0})},T("Выберите:",e)}(),"USD"===e.text&&function(){var e;e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"NMC",callback_data:"nmc_usd"},{text:"PPC",callback_data:"ppc_usd"},{text:"NVC",callback_data:"nvc_usd"},{text:"LTC",callback_data:"ltc_usd"},{text:"BTC",callback_data:"btc_usd"}],[{text:"DSH",callback_data:"dsh_usd"},{text:"ETH",callback_data:"eth_usd"},{text:"EUR",callback_data:"eur_usd"},{text:"RUR",callback_data:"usd_rur"}]]})},T("Символ:",e)}(),"BTC"===e.text&&function(){var e;e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"NMC",callback_data:"nmc_btc"},{text:"PPC",callback_data:"ppc_btc"},{text:"NVC",callback_data:"nvc_btc"},{text:"LTC",callback_data:"ltc_btc"}],[{text:"DSH",callback_data:"dsh_btc"},{text:"ETH",callback_data:"eth_btc"},{text:"RUR",callback_data:"btc_rur"},{text:"EUR",callback_data:"btc_eur"}]]})},T("Символ:",e)}(),"OTHER"===e.text&&function(){var e;e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"ETH/LTC",callback_data:"eth_ltc"},{text:"ETH/EUR",callback_data:"eth_eur"},{text:"ETH/RUR",callback_data:"eth_rur"}],[{text:"LTC/RUR",callback_data:"ltc_rur"},{text:"LTC/EUR",callback_data:"ltc_eur"},{text:"EUR/RUR",callback_data:"eur_rur"}]]})},T("Пара:",e)}(),"Контроль"===e.text&&function(){var e;e={reply_markup:JSON.stringify({keyboard:[[{text:"Скорость"},{text:"Состояние"},{text:"Модули"}],[{text:"Главное меню"}]],resize_keyboard:!0})},T("Выберите:",e)}(),"Нотис"===e.text&&function(){var e;e={reply_markup:JSON.stringify({keyboard:[[{text:"Мониторинг"},{text:"Уведомление"}],[{text:"Круг"}],[{text:"Главное меню"}]],resize_keyboard:!0})},T("Выберите:",e)}(),"Мониторинг"===e.text&&function(){var e,r;e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"Старт",callback_data:"monitoring start"},{text:"Стоп",callback_data:"monitoring stop"}]]})},r=ge.status?"Работает.":"Остановлен.",T(["Включает мониторинг возможных торговых пар. Уведомление раз в 5 минут.","Текущие состояние: `"+r+"`"].join("\n"),e)}(),"Уведомление"===e.text&&function(){var e,r;e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"Старт",callback_data:"notification start"},{text:"Стоп",callback_data:"notification stop"}]]})},r=Ee.status?"Работает.":"Остановлен.",T(["Включает уведомления о скачках курса.","Текущие состояние: `"+r+"`"].join("\n"),e)}(),"Круг"===e.text&&Qe(),"Тип"===e.text&&function(){var e,r;e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"Only buy",callback_data:"type buy"},{text:"Only sell",callback_data:"type sell"},{text:"Buy & Sell",callback_data:"type all"}]]})},r=["Текущий тип торговли *"+ie.toUpperCase()+"*","Новый тип:"],T(r.join("\n"),e)}(),"Сменить пару"===e.text&&function(){var e,t;"btc-e"===r.exchange?(e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"BTC/USD",callback_data:"trade btc_usd"},{text:"BTC/RUR",callback_data:"trade btc_rur"},{text:"BTC/EUR",callback_data:"trade btc_eur"}],[{text:"LTC/BTC",callback_data:"trade ltc_btc"},{text:"LTC/USD",callback_data:"trade ltc_usd"},{text:"LTC/RUR",callback_data:"trade ltc_rur"}],[{text:"LTC/EUR",callback_data:"trade ltc_eur"},{text:"NMC/BTC",callback_data:"trade nmc_btc"},{text:"NMC/USD",callback_data:"trade nmc_usd"}],[{text:"NVC/BTC",callback_data:"trade nvc_btc"},{text:"NVC/USD",callback_data:"trade nvc_usd"},{text:"PPC/BTC",callback_data:"trade ppc_btc"}],[{text:"PPC/USD",callback_data:"trade ppc_usd"},{text:"DSH/BTC",callback_data:"trade dsh_btc"},{text:"DSH/USD",callback_data:"trade dsh_usd"}],[{text:"ETH/BTC",callback_data:"trade eth_btc"},{text:"ETH/USD",callback_data:"trade eth_usd"},{text:"ETH/EUR",callback_data:"trade eth_eur"}],[{text:"ETH/LTC",callback_data:"trade eth_ltc"},{text:"ETH/RUR",callback_data:"trade eth_rur"},{text:"USD/RUR",callback_data:"trade usd_rur"}],[{text:"EUR/USD",callback_data:"trade eur_usd"},{text:"EUR/RUR",callback_data:"trade eur_rur"}]]})},t=["Текущая пара: *"+g()+"*","`Внимание! На новой паре должны быть средства для торгов, иначе переключение завершится ошибкой!`","Новая торгая пара:"],T(t.join("\n"),e)):T("*Этот пункт не доступен для данной биржи*")}(),"Изменить отступ"===e.text&&function(){var e,t,n,a,o;r.offsetOrdersExponential?(e="%",t="Изменяет отсуп ордеров по экспоненте в %",n="Остальные: *"+r.offsetOrdersExponential+"%*"):r.offsetOrdersPercent?(e="%",t="Изменяет отсуп ордеров в процентах",n="Остальные: *"+r.offsetOrdersPercent+"%*"):r.rangeOffset?(e="%",t="Изменяет размер сетки ордеров в процентах",n="Размер сетки: *"+r.rangeOffset+"%*"):(e="",t="Изменяет отсуп первого ордера в процентах, всех остальных в пунктах.",n="Остальные: *"+r.offsetOrdersPoints+"*"),a={reply_markup:JSON.stringify({inline_keyboard:[[{text:"+ 0.1% First",callback_data:"offset_orders first_plus"},{text:"- 0.1% First",callback_data:"offset_orders first_minus"}],[{text:"+ 0.1"+e,callback_data:"offset_orders plus"},{text:"- 0.1"+e,callback_data:"offset_orders minus"}]]})},o=["*"+t+"*","Текущий отступ:","Первый: *"+r.offsetFirstOrdersPercent+"%*",n].join("\n"),T(o,a)}(),"Авто выход из пары"===e.text&&function(){var e,n,a;r.oneOrdersSell?(e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"Вкл",callback_data:"autoexit on"},{text:"Выкл",callback_data:"autoexit off"}]]})},n=["*Авто выход из пары*","Текущее состояние: *"+(ye?"Вкл":"Выкл")+"*","Средняя цена покупки: "+((a=t.rounded(j.priceBuy,8))>0?a:0)].join("\n"),T(n,e)):T("На текущей стратегии данная функция недоступна!")}(),"Скорость"===e.text&&function(){var e,r;e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"Normal",callback_data:"speed normal"},{text:"Extra",callback_data:"speed extra"}]]})},r=["Влияет на плотность стека ордеров, размер спреда и время закрытия неиспользованных ордеров","Время действия "+t.declOfNum(D)+".","Текущая скорость: *"+ce+"*"].join("\n"),T(r,e)}(),"Состояние"===e.text&&function(){var e;e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"Пауза",callback_data:"worker pause"},{text:"Продолжить",callback_data:"worker continued"}]]})},T("Текущие состояние: `"+(U?"Пауза":"Работает")+"`",e)}(),"Модули"===e.text&&function(){var e;e={reply_markup:JSON.stringify({inline_keyboard:[[{text:"Динам. время обновления "+(r.dynamicSettingsTime?"[Вкл]":"[Выкл]"),callback_data:"modules dynamic-settings-time"}],[{text:"Динам. распределение ордеров "+(r.dynamicOffsetOrders?"[Вкл]":"[Выкл]"),callback_data:"modules dynamic-offset-orders"}],[{text:"Определение тренда "+(r.trendDefinition?"[Вкл]":"[Выкл]"),callback_data:"modules trend-definition"}],[{text:"Контроль смены тренда "+(r.abruptChangeTrend?"[Вкл]":"[Выкл]"),callback_data:"modules abrupt-change-trend"}],[{text:"Стоп при большом изменении цены "+(r.dangerPriceStop?"[Вкл]":"[Выкл]"),callback_data:"modules danger-price-stop"}],[{text:"Включить все",callback_data:"modules all-modules-on"},{text:"Выключить все",callback_data:"modules all-modules-off"}],[{text:"Полосы Боллинджера "+(r.bbands?"[Вкл]":"[Выкл]"),callback_data:"modules bbands"}],[{text:"One Sell a lot Buy "+(r.oneOrdersSell?"[Вкл]":"[Выкл]"),callback_data:"modules one-orders-sell"}],[{text:"Лог "+(r.botLog?"[Вкл]":"[Выкл]"),callback_data:"modules bot-log"},{text:"Дебаг лог "+(r.logDebug?"[Вкл]":"[Выкл]"),callback_data:"modules log-debug"}]]})},T("*Модули обновления настроек:*",e)}(),"/info"===(null!=(u=e.text)?u.toLowerCase():void 0)&&T(["Список команд:\n","/version - версия бота","/params - параметры которые можно менять через Telegram","/config - возможные параметры конфигурации через конфигурационный файл","/martin - теоретический расчет ордеров Мартингейла (параметры берутся из конфига)","/ticker coin_name - показывает котировку пары coin_name"].join("\n"),{format:!1}),"/version"===(null!=(c=e.text)?c.toLowerCase():void 0)&&function(){var e;e=["Версия бота: `"+f.ver+"`"],f.version&&f.ver!==f.version&&e.push("New version: "+f.version),T(e.join("\n"))}(),"/config"===(null!=(d=e.text)?d.toLowerCase():void 0)&&function(){var e;e=["Бот на паре: "+g(),"EXCHANGE: "+r.exchange+" | Выбор биржи btc-e, poloniex, bittrex","EXCHANGE_FEE: "+pe+" | Комиссия на сделки","TIME_UPDATE_AUTO_SETTINGS: "+D+" | время обновления авто настроек параметров (в мин)","DEPOSIT_LIMIT_PERCENT: "+r.depositLimit.percent+" | процент использования депозита","DEPOSIT_LIMIT_CURRENCY: "+r.depositLimit.currency+" | использования депозита в валюте","NOTIFICATION_PAIR: "+r.notificationPair+" | пары для уведомления (или all/all для всех)","NOTIFICATION_DEVIATION_PERCENT: "+r.notificationDeviation+" | насколько процентов должен увеличиться спред чтобы сработало уведомление","COUNT_ORDERS: "+r.countOrders+" | количество ордеров","QUANTITY_ORDERS_IN_BLOCKS: "+r.quantityOrdersInBlocks+" | количество ордеров в блоке","TIME_CLOSE_ORDERS: "+r.timeCloseOrders+" | сколько минут ждать перед закрытием неисполнившихся ордеров","TIME_CLOSE_ORDERS_INACTIVITY: "+r.timeCloseOrdersInactivity+" | закрытие после бездействия","OFFSET_ORDERS_POINTS: "+r.offsetOrdersPoints+" | отступ ордеров в пунктах","OFFSET_ORDERS_PERCENT: "+r.offsetOrdersPercent+" | отступ для ордеров в %","OFFSET_ORDERS_EXPONENTIAL: "+r.offsetOrdersExponential+" | отступ для ордеров по экспоненте в %","OFFSET_FIRST_ORDERS_PERCENT: "+r.offsetFirstOrdersPercent+" | отступ первого ордера в %","RANGE_OFFSET: "+r.rangeOffset+" | диапазон смещения ордеров в %","SIZE_ORDERS_MARTINGALE: "+Y+" | размер ордера в % Мартингейла","MARTINGALE_TYPE: "+r.martingaleType+" | тип Мартингейла","STEP_BREAKEVEN_PERCENT: "+r.stepBreakevenPercent+" | процент отступа безубытка для торгов","DANGER_PRICE_STOP: "+r.dangerPriceStop+" | остановка бота при большом изменении цены","DYNAMIC_SETTINGS_TIME: "+r.dynamicSettingsTime+" | динамическое время обновления настроек","DYNAMIC_OFFSET_ORDERS: "+r.dynamicOffsetOrders+" | динамическое распределение ордеров","TREND_DEFINITION: "+r.trendDefinition+" | определение тренда","ABRUPT_CHANGE_TREND: "+r.abruptChangeTrend+" | быстрое изменение направления тренда","BBANDS: "+r.bbands+" | Стратегия Полосы Боллинджера","BBANDS_DEVIATION: "+r.bbandsDeviation+" | Отклонение","BBANDS_INTERVAL: "+r.bbandsInterval+" | Таймфрейм (в мин)","ONE_ORDERS_SELL: "+r.oneOrdersSell+" | Стратегия One Sell a lot Buy","ONE_ORDERS_SELL_PERCENT: "+M+" | Задает процент желаемой прибыли","ONE_ORDERS_SELL_OFFSET: "+r.oneOrdersSellOffset+" | Разница между ценой LastPrice и первым ордером buy в стеке ордеров в %","INTEGRITY_CONTROL_ORDERS: "+r.integrityControlOrders+" | Контроль целостности ордеров (soft - мягкий, hard - жесткий)","FIRST_LOADING_HISTORY: "+r.firstLoadingHistory+" | Загрузка истории при старте бота","CYCLES_AUTO_EXIT: "+r.cyclesAutoExit+" | Автовыход через N циклов"],T(e.join("\n\n"),{format:!1})}(),"/params"===(null!=(p=e.text)?p.toLowerCase():void 0)&&function(){var e;e=["Бот на паре: "+g()+" | Exchange: "+r.exchange.toUpperCase(),"TIME_UPDATE_AUTO_SETTINGS="+D+" | время обновления авто настроек параметров (в мин)","OFFSET_ORDERS_POINTS="+r.offsetOrdersPoints+" | отступ для ордеров в пунктах","OFFSET_ORDERS_PERCENT="+r.offsetOrdersPercent+" | отступ для ордеров в процентах","RANGE_OFFSET= "+r.rangeOffset+" | диапазон смещения ордеров в %","OFFSET_FIRST_ORDERS_PERCENT="+r.offsetFirstOrdersPercent+" | отступ первого ордера в процентах","STEP_BREAKEVEN_PERCENT="+r.stepBreakevenPercent+" | процент отступа безубытка для торгов","TIME_CLOSE_ORDERS="+r.timeCloseOrders+" | сколько минут ждать перед закрытием неисполнившихся ордеров","COUNT_ORDERS="+r.countOrders+" | количество ордеров (бот будет переазгружен)","QUANTITY_ORDERS_IN_BLOCKS="+r.quantityOrdersInBlocks+" | количество ордеров в блоке","SIZE_ORDERS_MARTINGALE="+Y+" | размер ордера мартингейла (проценты или абсолютное число)","DEPOSIT_LIMIT_PERCENT="+r.depositLimit.percent+" | процент использования депозита (бот будет перезагружен)","DEPOSIT_LIMIT_CURRENCY="+r.depositLimit.currency+" | использования депозита в валюте (бот будет перезагружен)","ONE_ORDERS_SELL_PERCENT="+M+" | Задает процент желаемой прибыли","ONE_ORDERS_SELL_OFFSET="+r.oneOrdersSellOffset+" | Разница между ценой LastPrice и первым ордером buy в стеке ордеров в процентах","RESTART_TRADER_TIME="+r.restartTraderTime+" | Через сколько секунд рестартовать воркер после ошибки","INTEGRITY_CONTROL_ORDERS="+r.integrityControlOrders+" | Контроль целостности ордеров (soft - мягкий, hard - жесткий)","FIRST_LOADING_HISTORY="+r.firstLoadingHistory+" | Загрузка истории при старте бота","CYCLES_AUTO_EXIT="+r.cyclesAutoExit+" | Автовыход через N циклов"],T(e.join("\n\n"),{format:!1})}(),/(\D+)=(\w+)/.test(e.text)&&function(){var n,a,l;if(n=e.text.split("="),n[0]=n[0].toUpperCase(),n[1]=t.envConvert((a={},a[n[0]+""]=n[1],a))[n[0]],"TIME_UPDATE_AUTO_SETTINGS"===(a=n[0])||"OFFSET_ORDERS_POINTS"===a||"OFFSET_ORDERS_PERCENT"===a||"RANGE_OFFSET"===a||"OFFSET_FIRST_ORDERS_PERCENT"===a||"TIME_CLOSE_ORDERS"===a||"STEP_BREAKEVEN_PERCENT"===a||"DEPOSIT_LIMIT_PERCENT"===a||"DEPOSIT_LIMIT_CURRENCY"===a||"FIRST_LOADING_HISTORY"===a||"COUNT_ORDERS"===a||"QUANTITY_ORDERS_IN_BLOCKS"===a||"ONE_ORDERS_SELL_PERCENT"===a||"ONE_ORDERS_SELL_OFFSET"===a||"SIZE_ORDERS_MARTINGALE"===a||"RESTART_TRADER_TIME"===a||"INTEGRITY_CONTROL_ORDERS"===a||"CYCLES_AUTO_EXIT"===a){switch(l=o.camelCase(n[0]),n[0]){case"SIZE_ORDERS_MARTINGALE":Y=+n[1];break;case"DEPOSIT_LIMIT_PERCENT":r.depositLimit.percent=+n[1];break;case"DEPOSIT_LIMIT_CURRENCY":r.depositLimit.currency=+n[1];break;case"INTEGRITY_CONTROL_ORDERS":r.integrityControlOrders=n[1];break;default:r[l]=+n[1]}b.warn("SET "+n[0]+"="+n[1]),T("Настройки обновлены!"),"DEPOSIT_LIMIT_PERCENT"!==(a=n[0])&&"DEPOSIT_LIMIT_CURRENCY"!==a&&"COUNT_ORDERS"!==a&&"FIRST_LOADING_HISTORY"!==a||(U=!0,Fe(r.tradeCurrency.pair,function(e){var r;null!=e?(r=S(e),b.error(r),T("`"+r+"`")):(U=!1,T("*Бот перезапущен!*"))}))}}(),"/martin"===(null!=(m=e.text)?m.toLowerCase():void 0)&&function(){var e,n,o,l,i,u,s;e=te,n=!0,o=0,l=0,i=0,u=0,s="inverse"===r.directionCurrency?Be(k.balance,"name"):Be(k.balanceTwo,"nameTwo"),s+=k.cache*e,a.doWhilst(function(a){var c;return r.offsetFirstOrdersPercent&&n?(e-=B.first,n=!1):r.offsetOrdersExponential?(i+=r.offsetOrdersExponential,e=t.amountMinusPercent(e,i)):e-=$e,o=s/e,r.sizeOrdersMartingale&&(l=l?1===r.martingaleType?t.amountPlusPercent(l,r.sizeOrdersMartingale):l+Y:H),c=o>l?l:o,s=(o-c)*e,u++,a(null)},function(){return o>H},function(){var r,n;return r=t.percentageBetweenNumbers(te,e),n=["*Данные расчета Мартингейла*:"],1===u&&s<=0?n.push("`Недостаточно средств!`"):(n.push(["Количество ордеров: "+u,"Последняя цена: "+t.rounded(e,de),"*Разница между LastPrice и последним ордером: "+r+"%*"].join("\n")),0<r&&r<=2&&n.push("`При таких настройках депозита хватит на "+r+"% хода цены вниз!!! Не мало ли?`")),T(n.join("\n\n"))})}(),/\/ticker (\w+)/.test(null!=(O=e.text)?O.toLowerCase():void 0)&&Ve(e.text.replace(/-|\//,"_").toLowerCase().substr(7).trim()))}),y.on("callback_query",function(e){if(e.from.id===r.myChatId)switch(!1){case!/trade (\w*_(usd|rur|eur|btc|ltc))/.test(e.data):Me(e.data.substr(6));break;case!/speed (normal|extra)/.test(e.data):Ge(e.data.substr(6));break;case!/autoexit (on|off)/.test(e.data):He(e.data.substr(9));break;case!/worker (continued|pause)/.test(e.data):ze(e.data.substr(7));break;case!/monitoring (start|stop)/.test(e.data):Ke(e.data.substr(11));break;case!/notification (start|stop)/.test(e.data):Xe(e.data.substr(13));break;case!/type (buy|sell|all)/.test(e.data):qe(e.data.substr(5));break;case!/modules (\w*)/.test(e.data):Je(e.data.substr(8));break;case!/offset_orders (plus|minus)/.test(e.data):case!/offset_orders (first_plus|first_minus)/.test(e.data):Ye(e.data.substr(14));break;case!/close_orders_now/.test(e.data):je();break;default:Ve(e.data)}}),je=function(){T("Начато закрытие ордеров."),U=!0,A.all=1,r.oneOrdersSell&&(z.buy=0,J.buy=0,F.buy=0),setTimeout(function(){yr(r.tradeCurrency.pair,function(e){var r,t;null!=e?0===e.success&&(null!=(r=null!=(t=e.error)?t.split("send:")[1]:void 0)?(_.setNonce(r),je()):T("`"+S(e)+"`")):(T("Активные ордера закрыты на паре: "+g()),dr(function(e){if(null!=e)return T("`"+S(e)+"`")})),U=!1})},l("2s"))},Me=function(e){var t,n;T("Инициализировано изменение пары..."),U=!0,t=e.split("_")[0],n=e.split("_")[1],r.tradeCurrency.name===t&&r.tradeCurrency.nameTwo!==n?A.sell=1:r.tradeCurrency.name!==t&&r.tradeCurrency.nameTwo===n&&(A.buy=1),setTimeout(function(){yr(r.tradeCurrency.pair,function(){r.tradeCurrency={name:t,nameTwo:n,pair:[t,n].join("_")},L=!0,ir(r.tradeCurrency.pair,function(e){var r,t;null!=e?(r=S(e),b.error(("Ошибка получения данных с сервера!\n"+r).red),t=["`Critical error: Ошибка получения данных с сервера!`","Бот поставлен на паузу, после обновления баланса необходимо перезапустить пару!","Ошибка: "+r].join("\n"),T(t),U=!0):(Q=0,U=!1,T("Выполнено! Новая пара: "+g()))})})},l("5s"))},qe=function(e){me="all"!==e,T("Выполнено! Новый тип "+(ie=e).toUpperCase())},Ge=function(e){nr(e,function(){var r;return r=["Режим "+e.toUpperCase()+" включен.","Пара: "+g()],N=t.currentTime(),b.info(r[0]),T(r.join(" "))})},He=function(e){var t;"on"===e?(M=0,ye=!0,t="Авто выход включен!"):(M=r.oneOrdersSellPercent,ye=!1,t="Авто выход выключен!"),T(t)},ze=function(e){T("Новое состояние: `"+((U="pause"===e)?"Пауза":"Работает")+"`. Пара: "+g())},Ye=function(e){var n,a,o;n="plus"===e||"first_plus"===e?.1:-.1,"plus"!==e&&"minus"!==e||(r.offsetOrdersExponential?(r.offsetOrdersExponential=t.rounded(r.offsetOrdersExponential+n,1),r.offsetOrdersExponential>=.1||(r.offsetOrdersExponential=.1),a="Остальные: *"+r.offsetOrdersExponential+"%*"):r.offsetOrdersPercent?(r.offsetOrdersPercent=t.rounded(r.offsetOrdersPercent+n,1),r.offsetOrdersPercent>=.1||(r.offsetOrdersPercent=.1),a="Остальные: *"+r.offsetOrdersPercent+"%*"):r.rangeOffset?(r.rangeOffset=t.rounded(r.rangeOffset+n,1),r.rangeOffset>=.1||(r.rangeOffset=.1),a="Размер сетки: *"+r.rangeOffset+"%*"):(r.offsetOrdersPoints=t.rounded(r.offsetOrdersPoints+n,1),r.offsetOrdersPoints>=.1||(r.offsetOrdersPoints=.1),a="Остальные: *"+r.offsetOrdersPoints+"*")),"first_plus"!==e&&"first_minus"!==e||(r.offsetFirstOrdersPercent=t.rounded(r.offsetFirstOrdersPercent+n,1),r.offsetFirstOrdersPercent>=0||(r.offsetFirstOrdersPercent=0)),o=["Новый отступ на паре "+g()+":","Первый: *"+r.offsetFirstOrdersPercent+"%*",a||void 0].join("\n"),T(o+"")},Je=function(e){var t,n;/\all-modules/.test(e)?(t="all-modules-on"===e,r.dynamicSettingsTime=t,r.dynamicOffsetOrders=t,r.trendDefinition=t,r.abruptChangeTrend=t,r.dangerPriceStop=t,r.dynamicSettingsTime||(D=r.timeUpdateAutoSettings),T("Все модули "+(t?"включены":"выключены")+"!")):("one-orders-sell"===e&&(r.bbands=!1),"bbands"===e&&(r.oneOrdersSell=!1),n=e.replace(/\-./g,function(e,r,t){return e.replace("-","").toUpperCase()}),r[n]=!r[n],T(e.replace(/\-/g,"_").toUpperCase()+": "+r[n],{format:!1}))},Ve=function(e){_.getTicker(e,function(n,a){var o,l,i,u,s,c,d,f,p,b,m;return null!=n?T("`"+S(n)+"`"):(o=or.pairs[e].decimal_places,l=a[e].last,i=a[e].sell,u=a[e].buy,s=a[e].avg?a[e].avg:(i+u)/2,s=t.rounded(s,o),c=t.rounded(u-i,o),d=e.split("_")[1],f=ke(u,r.stepBreakevenPercent,o),p=c>f?"✔":"`✗`",b=l>s?"↑":"`↓`",m=["*"+e.replace("_","/").toUpperCase()+"*:","sell: "+ve(d)+i,"buy: "+ve(d)+u,"last: "+ve(d)+l,"avg: "+ve(d)+s+" | "+b,"spread:   "+c+" | "+(c/f*100-100).toFixed()+"%","required: "+f+" "+p],T(m.join("\n")))})},Ke=function(e){var r;ge.status="start"===e,clearInterval(ge.interval),ge.status?(r="Работает",We(),ge.interval=setInterval(function(){We()},l("5m"))):r="Остановлен",T("Новое состояние: "+r)},Xe=function(e){var r;null!=Te&&Te.length?(Ee.status="start"===e,clearInterval(Ee.interval),Ee.status?(r="Работает",Ze()):r="Остановлен",T("Новое состояние: "+r)):T("`Внимание! Конфиг для уведомлений не задан!`")},We=function(){var e;e=lr.join("-"),a.parallel([function(r){return _.getTicker(e,function(e,t){return null!=e?r(e):r(null,t)})},function(r){return _.getTrades(e,{limit:2},function(e,t){return null!=e?r(e):r(null,t)})}],function(e,n){var a,u,s,c,d,f;if(null!=e)return a=S(e),u="Error trading pairs available: "+a,T(u),void b.error(u.red);s=["Доступные пары для торгов:\n"],c=o.now(),d=i.range(c-l("1m"),c),f=0,lr.forEach(function(e){var a,o,l,i,u,c,p,b,m,_,y,O,E;a=e.split("_")[1],o=e.split("_")[0],l=or.pairs[e].decimal_places,i=n[0][e].last,u=n[0][e].sell,c=n[0][e].buy,p=n[0][e].vol,b=n[0][e].vol_cur,m=n[0][e].avg?n[0][e].avg:(u+c)/2,m=t.rounded(m,l),_=t.rounded(c-u,l),y=ke(c,r.stepBreakevenPercent,l),O=i>m?"↑":"`↓`",E=!n[1][e][0].timestamp||d.contains(1e3*n[1][e][0].timestamp)&&d.contains(1e3*n[1][e][1].timestamp),_>y&&E&&(f++,s.push("*"+e.replace("_","/").toUpperCase()+"*\nprice: "+c+" - "+u+"\navg:   "+m+" | "+O+"\nvol:  "+b+" "+ve(o)+"\nvol:  "+p+" "+ve(a)+"\nspread:   "+t.noExp(_)+" | "+(_/y*100-100).toFixed()+"%\nrequired: "+t.noExp(y)+"\n")),f>=20&&(T(s.join("\n")),f=0,s=[])}),setTimeout(function(){s.length&&T(s.join("\n"))},l("2s"))})},Ze=function(){var n,a;null!=Te&&Te.length&&("all_all"===Te[0]&&(Te=lr),n=Te.join("-"),a={},Ee.interval=setInterval(function(){_.getTicker(n,function(n,o){var i,u,s;return null==n?(s=0,u=[],Te.forEach(function(n){var i,c,d,f,p,b,m,_,y,O,E,g;r.tradeCurrency.pair!==n&&e(n,lr)&&(a[n]||(i=or.pairs[n].decimal_places,c=o[n].sell,d=o[n].buy,f=o[n].last,p=o[n].vol,b=o[n].vol_cur,m=o[n].avg?o[n].avg:(c+d)/2,m=t.rounded(m,i),(_=t.rounded(d-c,i))>ke(c,r.notificationDeviation,i)&&(s++,a[n]=!0,y=n.split("_")[1],O=n.split("_")[0],E=f<=c||f<=c+xe(3,i)?"down ↓":"up ↑",g=f>m?"↑":"`↓`",u.push(["Уведомление *"+n.replace("_","/").toUpperCase()+"*:","directions: "+E,"sell: "+ve(y)+c,"buy: "+ve(y)+d,"last: "+ve(y)+f,"avg: "+ve(y)+m+" | "+g,"vol: "+b+" "+ve(O),"vol: "+p+" "+ve(y),"spread: "+t.noExp(_)+"\n"].join("\n"))),s>=15&&(T(u.join("\n")),s=0,u=[]),setTimeout(function(){a[n]=!1,a.error=!1},l("15m"))))}),setTimeout(function(){u.length&&T(u.join("\n"))},l("2s"))):(i=S(n),u="Error notification price: "+i,b.error(u.red),a.error?void 0:(T(u),a.error=!0))})},l("5s")))},Qe=function(r,n){var a,o,l,i;null==r&&(r=.993),null==n&&(n=!1),a={},o={},l={},i={},lr.forEach(function(e){var r;r=e.split(/\s*_\s*/),a[r[0]]?a[r[0]].push(r[1]):a[r[0]]=[r[1]]}),_.getTicker(lr.join("-"),function(u,s){var c,d,f;return null!=u?(c=S(u),T("`Error: "+c+"`")):(lr.forEach(function(e){o[e]=we(1,s[e].buy)}),lr.forEach(function(e){var r;r=e.split(/\s*_\s*/),a[r[0]].forEach(function(t){t!==r[1]&&(l[r[1]+"_"+r[0]+"_"+t]=Ne(o[e],s[r[0]+"_"+t].sell))})}),Object.keys(l).forEach(function(n){var a,o;e((a=n.split(/\s*_\s*/))[0]+"_"+a[2],lr)&&(o=we(l[n],s[a[0]+"_"+a[2]].buy)),e(a[2]+"_"+a[0],lr)&&(o=Ne(l[n],s[a[2]+"_"+a[0]].buy)),o>r&&(i[n+"_"+a[0]]=t.rounded(o,5))}),d=["Проверка возможных вариантов перепродаж.","Показаны значения больше: "+r,"Значения меньше 1 убыточны:\n"],f=[],Object.keys(i).forEach(function(e){f.push([e.replace(/\_/g,"->"),i[e]])}),f.length?f.sort(function(e,r){return r[1]-e[1]}).forEach(function(e){d.push(e.join(": "))}):d.push("Нет подходящих вариантов"),!n||f.length?T(d.join("\n")):void 0)})},nr=function(e,t){var n;return null!=e&&(n=e),null==t&&(t=function(){}),n||(n=Q>$?"extra":"normal"),Q=0,"extra"===n?($e=B.extra,er=B.extra,tr=G,rr=60*r.timeCloseOrdersExtra):($e=B.buy,er=B.sell,tr=q,rr=60*r.timeCloseOrders),ce=n,t()},ar=0,ir=function(e,r){return _.getInfo(function(t,n){if(null!=t)return r(t);try{or=n,lr=Object.keys(n.pairs),de=n.pairs[e].decimal_places,be=n.pairs[e].min_amount,fe=n.pairs[e].min_price,pe=n.pairs[e].fee}catch(e){r("Not valid pair")}return o.delay(Fe,l("3s"),e,function(t){var n,a;return t?null!=(n=null!=(a=t.error)?a.split("send:")[1]:void 0)?(_.setNonce(n),ir(e,r)):++ar>=5?(ar=0,r(t)):ir(e,r):r(null)})})},ur=function(e,r){return _.ordersRequest(e,function(e,t){return null!=e&&"no orders"!==e.error?r(e):r(null,t)})},sr=function(e,r){return _.getTicker(e,function(n,a){var o,l,i,u;return null!=n?r(n):(o=a[e].last,l=a[e].sell,i=a[e].buy,u=t.rounded(i-l,de),ee=tr<=xe(2)?u>=tr:u>tr,r(null,{lastPrice:o,bidPrice:l,askPrice:i,spread:u}))})},cr=function(e,t){return ee?_.balanceRequest(e,function(e,n,a){return null!=e?t(e):(n=Be(n,"name"),a=Be(a,"nameTwo"),"all"===ie?n<be&&a<be?re<r.ecoCountCycle&&re++:re>0&&(re=0):re=r.ecoCountCycle,t(null,{balance:n,balanceTwo:a}))}):t(null)},dr=function(e){return ae?o.delay(_.balanceRequest,l("3s"),r.tradeCurrency,function(n,a,o){var l,i,u,s,c,d,f,p,b,m,_,y;return null!=n?e(n):(l={balance:Be(k.balance,"name"),balanceTwo:Be(k.balanceTwo,"nameTwo")},"inverse"===r.directionCurrency?(l.balance+=k.cacheTwo,l.balanceTwo-=k.cache):(l.balance-=k.cache,l.balanceTwo+=k.cacheTwo),l.deposit=Ie(l.balance,l.balanceTwo,ae).depositTwo,i={balance:Be(a,"name"),balanceTwo:Be(o,"nameTwo")},i.deposit=Ie(i.balance,i.balanceTwo,ae).depositTwo,u=t.rounded(i.balance-l.balance,5),s=t.rounded(i.balanceTwo-l.balanceTwo,5),c=t.rounded(i.deposit-l.deposit,5),d=u>=0?u:"`"+u+"`",f=s>=0?s:"`"+s+"`",p=c>=0?c:"`"+c+"`",b=t.percentageBetweenNumbers(i.balance,l.balance),m=t.percentageBetweenNumbers(i.balanceTwo,l.balanceTwo),_=t.percentageBetweenNumbers(i.deposit,l.deposit),y=["*Анализ торговли за сессию:*",d+" "+ve(r.tradeCurrency.name)+" | "+b+"%",f+" "+ve(r.tradeCurrency.nameTwo)+" | "+m+"%","Total: "+p+" "+ve(r.tradeCurrency.nameTwo)+" | "+_+"%  по цене: "+ae,"Установлено ордеров: "+Ce.ordersAll,"Исполнено ордеров: "+Ce.ordersExecuted,"Перезапусков: "+Ce.error],T(y.join("\n")),e(null))}):e(null)},fr=function(e,r){return ur(e,function(e,n){var a;return null!=e?r(e):(X=null!=n?n:{},a=t.quantityOrdersType(X),Z={buy:a.buy,sell:a.sell},r(null))})},pr=function(e,n){var a,l;return(a=o.findKey(X,["type","sell"]))&&t.rounded(j.amount-1e-7,8)>X[a].amount&&(b.info("SELL partially executed"),r.logDebug&&(l=[Se,"Старый sell: "+t.rounded(j.amount-1e-7,8)+"  Новый sell: "+X[a].amount,"Продано: "+t.rounded(t.rounded(j.amount-1e-7,8)-X[a].amount,8)+" "]),K=X,j.amount=X[a].amount,K["0000000001"]={rate:j.priceBuy,amount:j.amount},delete K[a],r.logDebug&&b.info(l.join("\n"))),W=!1,!a&&j.id&&(b.info("SELL executed!"),A.buy=1,W=!0,j={},K={},w=0,z={buy:0,sell:0},J={buy:0,sell:0},F={buy:0,sell:0},r.cyclesAutoExit&&(Ce.sellCount++,Ce.sellCount>=r.cyclesAutoExit&&(ye=!0,Ce.sellCount=0)),ye&&(U=!0,ye=!1,M=r.oneOrdersSellPercent,yr(e,function(e){var r;null!=e&&b.error(S(e)),r="Авто выход завершен!  Бот поставлен на паузу!",b.warn(r),T("*"+r+"*"),dr(function(){})}))),n(null)},br=function(e,n,l,i,u){return("inverse"===r.directionCurrency?n<be||n*l<r.minSizeOrder:n<be)?u(null):0===o.size(K)?u(null):a.series([function(e){return A.sell=1,yr(i,e)},function(e){var a,l,i,u,s,c,d,f,p,m,_;return a=[],l=o.keys(X),i=o.keys(K),u=o.difference(i,l),r.logDebug&&a.push([Se,"Открытые ордера: "+l,"В кэше: "+i,"Купленные: "+u].join("\n")),s=0,c=0,d=0,u.forEach(function(e){d++,s+=+K[e].amount,c+=+K[e].amount*+K[e].rate,r.logDebug&&a.push("Ордер "+d+": "+e+"  Количество: "+ +K[e].amount+"  Цена: "+ +K[e].rate)}),d>0?(j.priceBuy=c/s,r.logDebug&&a.push(["Сумма: "+c+"  Общий объем: "+s+"  Объем с комиссией: "+t.rounded(t.amountMinusPercent(s,pe),8),"Средняя цена покупки: "+j.priceBuy].join("\n")),f=t.amountPlusPercent(c,2.5*pe+M)/s,r.logDebug&&a.push(["Комиссия: "+pe+"  Процент юзера: "+M+"   Общий процент: "+(2*pe+M),"Увеличенная сумма на процент: "+t.amountPlusPercent(c,2*pe+M),"Цена продажи: "+f].join("\n")),p=o.findKey(X,["type","sell"]),r.logDebug&&a.push(["Сумма с баланса биржи: "+n,p?"Сумма на открытом ордере SELL: "+X[p].amount:void 0].join("\n")),m=n,"hard"===r.integrityControlOrders&&(_=t.amountMinusPercent(s,pe),m=n>=_?n:_,a.push("Разница между кэшем и балансом биржи: "+t.rounded(_-n))),p&&(m=n+X[p].amount),r.logDebug&&(a.push("Общая сумма продажи: "+m),b.info(a.join("\n"))),j.amount=m,e(null,{rate:f,amount:m})):e(null,{rate:0,amount:0})}],function(r,t){return null!=r?u(r):t[1].rate>0?_r(e,t[1].rate,t[1].amount,i,function(e){return u(null!=e?e:null)}):u(null)})},mr=function(e,n,l,i,u){var s,c,d;if("inverse"===r.directionCurrency?n<be||n*l<r.minSizeOrder:n<be)return u(null);if(_e)return u(null);if(r.quantityOrdersInBlocks){if(r.quantityOrdersInBlocks<=Z[e])return u(null);s=!0}return c=!0,V={buy:-1,sell:-1},"all"===ie||ie===e?(void 0!==d&&null!==d||(d=l),a.doWhilst(function(a){var u,f,p;return ue?("sell"===e&&(d-=er),"buy"===e&&(d+=$e),n/=2,_r(e,d,n,i,a)):(r.logDebug&&(u=[Se]),"buy"===e?(r.oneOrdersSell&&(R||s)&&(R=!1,s=!1,o.isEmpty(X)||(c=!1,f=t.searchRate(X,"min"),o.isObject(f)&&f.rate<l&&(d=f.rate),r.logDebug&&u.push("Последняя цена в стеке: "+d))),r.offsetFirstOrdersPercent&&c?(d-=B.first,r.logDebug&&u.push("Цена рынка: "+l+"   Цена First ордера: "+d),c=!1):r.offsetOrdersExponential?(r.logDebug&&u.push(["Отступ Exponential: Прошлый: "+F[e],"Новый: "+t.rounded(F[e]+r.offsetOrdersExponential,8)].join("  ")),F[e]=F[e]+r.offsetOrdersExponential,d=t.amountMinusPercent(d,F[e])):d-=$e,n=-1===V.buy?n:V.buy/d,r.logDebug&&(-1===V.buy?u.push("Общий объем: "+n):u.push(["Остаточный баланс: "+V.buy,"Цена: "+t.rounded(d,8),"Общий объем: "+t.rounded(V.buy/d,8)].join("   ")))):(r.offsetFirstOrdersPercent&&c?(d+=B.first,r.logDebug&&u.push("Цена First ордера: "+t.rounded(d,8)),c=!1):r.offsetOrdersExponential?(r.logDebug&&u.push(["Отступ Exponential: Прошлый: "+F[e],"Новый: "+t.rounded(F[e]+r.offsetOrdersExponential,8)].join("  ")),F[e]=F[e]+r.offsetOrdersExponential,d=t.amountPlusPercent(d,F[e])):d+=er,n=-1===V.sell?n:V.sell,r.logDebug&&(-1===V.sell?u.push("Общий объем: "+n):u.push(["Остаточный баланс: "+V.sell,"Цена: "+t.rounded(d,8),"Общий объем: "+V.sell].join("  ")))),r.sizeOrdersMartingale?(z[e]?(r.logDebug&&(1===r.martingaleType?u.push(["Размер ордера: "+t.rounded(z[e],8),"Размер мартина: "+r.sizeOrdersMartingale,"Новый размер ордера: "+t.rounded(t.amountPlusPercent(z[e],r.sizeOrdersMartingale),8)].join("  ")):u.push(["Размер ордера: "+t.rounded(z[e],8),"Размер мартина: "+Y,"Новый размер ордера: "+t.rounded(z[e]+Y,8)].join("  "))),z[e]=1===r.martingaleType?t.amountPlusPercent(z[e],r.sizeOrdersMartingale):z[e]+Y):z[e]=H,J[e]&&(r.logDebug&&u.push(["Кеш мартина: "+t.rounded(J[e],8),"Старый размер ордера: "+t.rounded(z[e],8)].join("  ")),z[e]=J[e],J[e]=0),p=n>z[e]?z[e]:n,r.logDebug&&u.push(["Баланс: "+t.rounded(n,8),"Размер ордера: "+t.rounded(z[e],8)].join("  "))):(p=n>H?H:n,r.logDebug&&u.push(["Баланс: "+t.rounded(n,8),"Размер ордера: "+t.rounded(H,8)].join("  "))),r.logDebug&&(u.push("Новый размер ордера: "+t.rounded(p,8)+"  "+(t.rounded(p,8)<.01?"| Ордер не установлен":"")),b.info(u.join("\n"))),_r(e,d,p,i,a))},function(){return!(r.quantityOrdersInBlocks&&r.quantityOrdersInBlocks<=Z[e])&&n>H},function(e){return u(null!=e?e:null)})):u(null)},_r=function(e,n,a,l,i){return(n=t.rounded(n,de))>=fe||(n=fe),a=t.rounded(a-1e-7,8),("inverse"===r.directionCurrency?a<be||a*n<r.minSizeOrder:a<be)?i(null):_.tradeSetOrder(l,e,n,a,function(t,l){var u,s,c;return null!=t?(r.sizeOrdersMartingale&&(J[e]=z[e]),R=!0,u=S(t),b.error(("Error: "+u+" | "+e+" | rate: "+n+" | amount: "+a).red),i(t)):(s=0!=l.order_id?l.order_id:o.random(1e3,2e3),r.oneOrdersSell&&("buy"===e&&(K[s]={rate:n,amount:a}),"sell"===e&&(j.id=s)),r.quantityOrdersInBlocks&&Z[e]++,c="Open: "+e+" | id: "+s+" | rate: "+n+" | amount: "+a,b.info("buy"===e?c.green:c.yellow),"buy"===e?V.buy="inverse"===r.directionCurrency?Be(l.funds[r.tradeCurrency.name],"name"):Be(l.funds[r.tradeCurrency.nameTwo],"nameTwo"):V.sell="inverse"===r.directionCurrency?Be(l.funds[r.tradeCurrency.nameTwo],"nameTwo"):Be(l.funds[r.tradeCurrency.name],"name"),Q++,Ce.ordersAll++,Ce.ordersExecuted++,i(null))})},yr=function(e,r){return _.ordersRequest(e,function(e,n){var o,l,i;return w=t.currentTime(),null!=e?0===e.success&&null==(null!=(o=e.error)?o.split("send:")[1]:void 0)?(l=S(e),b.warn(("Cancel orders: "+l).yellow),r(null)):r(e):(i=Object.keys(n),a.eachSeries(i,function(e,r){if(null==A.all){if(null!=A.buy&&"sell"===n[e].type)return r(null);if(null!=A.sell&&"buy"===n[e].type)return r(null)}return w-n[e].timestamp_created>(A.buy||A.sell||A.all||60)?Tr(e,n[e].type,n[e].amount,n[e].rate,r):r(null)},function(e){return A={all:null,buy:null,sell:null},r(null!=e?e:null)}))})},Tr=function(e,t,n,a,o){return _.tradeCancelOrder({order_id:e},function(l,i){return null!=l?o(l):(r.oneOrdersSell&&(delete K[e],"sell"===t&&(j.id=0)),b.info(("Close: "+t+" | id: "+e+" | rate: "+a+" | amount: "+n).cyan),Q>0&&Q--,Ce.ordersExecuted>0&&Ce.ordersExecuted--,o(null))})},Or=function(){me||t.timeIsOver(w,r.timeCloseOrdersInactivity)&&yr(r.tradeCurrency.pair,function(e){null!=e&&b.error("Orders inactivity: "+S(e))})},Er=function(){var e;t.timeIsOver(P,20)&&(e="Unknown error: Worker does not meet!",b.warn(e.red),Cr({error:e}))},gr=function(){P=t.currentTime(),U?setTimeout(gr,l("30s")):a.series([function(e){return sr(r.tradeCurrency.pair,e)},function(e){return cr(r.tradeCurrency,e)}],function(e,t){var n,i,u,s;n=t[0],i=t[1],null!=e?(u=S(e),null!=(null!=(s=e.error)?s.split("send:")[1]:void 0)?b.warn(u):b.error(("ErrorData: "+u).red),Cr(e)):(L&&Ae(n.askPrice,n.bidPrice,n.lastPrice,function(){return L=!1}),ee?a.series([function(e){return D>0&&P-N>60*D?Ae(n.askPrice,n.bidPrice,n.lastPrice,e):e(null)},function(e){return P-w>rr?yr(r.tradeCurrency.pair,e):e(null)},function(e){return r.quantityOrdersInBlocks||r.oneOrdersSell?o.delay(fr,l("3s"),r.tradeCurrency.pair,e):e(null)},function(e){return r.botTrade&&v&&r.oneOrdersSell?pr(r.tradeCurrency.pair,e):e(null)},function(e){var t,a;return r.oneOrdersSell&&W?e(null):r.botTrade&&v?(t=ue?se.ask:n.askPrice,a="inverse"===r.directionCurrency?i.balanceTwo:i.balance,r.oneOrdersSell?br("sell",a,t,r.tradeCurrency.pair,e):(z.sell=0,F.sell=0,mr("sell",a,t,r.tradeCurrency.pair,e))):e(null)},function(e){var t,a;return r.oneOrdersSell&&W?e(null):r.botTrade&&v?(t=ue?se.bid:n.bidPrice,a="inverse"===r.directionCurrency?i.balance/t:i.balanceTwo/t,r.oneOrdersSell||(z.buy=0,F.buy=0),mr("buy",a,t,r.tradeCurrency.pair,e)):e(null)}],function(e){var t;null!=e?(t=S(e),b.error(("ErrorTrader: "+t).red),Cr(e)):setTimeout(gr,re===r.ecoCountCycle?l("2s"):10)}):setTimeout(gr,l("5s")))})},Cr=function(e){var n,a,i,u,s,c;n=t.currentTime(),u="restart after "+(i=null!=(i=(a=S(e)).match(/timeout to (.*) seconds/))?o.parseInt(i[1])+10:r.restartTraderTime)+" sec ...",b.warn(u),null==(s=null!=(c=e.error)?c.split("send:")[1]:void 0)&&(x.count++,x.text!==a&&(x.text=a,r.isEmail&&"production"===process.env.NODE_ENV&&E(C(a+"\n\n"+u),function(e,r){})),r.notificationErrorCount&&x.count>r.notificationErrorCount&&(T("`Слишком много ошибок API. Требуется внимание пользователя!`"),x.count=0)),n-x.date<i?b.warn("Error copies of the workers. Duplicate stopped!"):(x.date=n,setTimeout(function(){b.warn("trader restart"),Ce.error++,null!=s&&_.setNonce(s),gr()},l(i+"s")))},r.myChatId||r.telegramOff?(b.info("Trader Bot starting..."),b.info("Exchange: "+r.exchange.toUpperCase()+" | v."+r.versionBot),ir(r.tradeCurrency.pair,function(e){var t;return null!=e&&(t=S(e),b.error(("Error getting parameters from the server!\n"+t).red),process.exit(0)),gr(),r.botTrade&&setInterval(function(){p(),Or(),Er(),x.count=0},l("5m")),setInterval(function(){De()},l(10*r.bbandsInterval+"s")),"production"===process.env.NODE_ENV&&T("Trader Bot started. Pair "+g()),b.info("Trader Bot started")})):b.warn("Get the user id in the Telegram"),process.on("uncaughtException",function(e){return b.error("uncaughtException: ",e.message),b.error(e.stack)})}else b.warn("There is no token Telegram!");else b.warn("There is no KEY or SECRET api exchange!")}).call(this);